### 计划管理需求文档

需要支持的功能:

* 读取自动抽取的计划记录，支持手动添加计划记录
* 下发某个计划到某个产线中


前端需要显示的计划字段:
* 任务单号
* 物料编码
* 物料名称
* 计划生产物料数量
* 计划开工日期
* 备注
* 车间名
* 产线信息
* 录入人员
* 录入时间
* 修改时间
* 计划状态(状态有未开始, 已下发, 进行中, 暂停, 已完工)
* ERP计划状态(目前计划管理需要显示的ERP导入的计划状态包括2.确认, 3.下达, 4.投放, 5.流转)
* 计划类型(从ERP系统导入, 自定义计划)

// 定制字段
* 任务类型
* 主计划号
* 计划单号
* 规格型号
* 特殊要求

其中新增一个计划时有如下规则:
* 任务单号(必填)
* 物料编码 (必选): 物料编码和名称其中任一项选择后，另外一项自动选择对应值
* 物料名称 (必选)
* 计划生产物料数量:需要判断输入为合法正数
* 车间名(必选)


主数据配置:
需要订阅主数据中如下信息:
* 物料信息(主数据) -- 获取所有物料信息
* 计划管理车间产线信息(应用配置) -- 获取所有车间下的产线信息
* 计划管理计划定制字段(应用配置) -- 获取计划数据所有定制字段信息


前端交互需求:
```
目前页面中仅显示除已完工之外的所有计划，计划按照计划开工时间倒序排列，最近的排在前面。
目前仅支持新增和删除计划，删除只针对手动新增的计划可以操作。
下发某个计划到某个产线时，先选择产线，然后再选择日期，默认选择明天。选择的日期即为计划开工日期，覆盖之前设置的计划开工日期，同时计划状态改为已下发。
某个已经下发到某个产线的计划可以在计划开工日期之前回滚该计划，回滚之后该计划状态为未开始，计划开工日期为空。
```

计划状态:
```
当计划数据从ERP导入计划管理app或者手动新增一个计划之后，该计划状态为未开始。
当将计划下发到某个产线时，该计划状态变为已下发。在计划开工日期之前可以通过回滚操作将该计划重置为状态未开始。
计划状态中的进行中,暂停和已完工3种状态都需要从监控app通知获得。
当在监控app中，操作工刷卡切换计划时，该计划状态变为进行中，监控app将状态变更发到计划管理app。
当监控app中切换到别的计划，同时该产线任何工段都没有加工该计划，则该计划状态变为暂停，监控app发送状态变更请求的时候需要带上暂停时该计划的总合格数和不合格数。
当该计划在监控app中加工完成时，该计划状态变为已完工，监控app发过来的状态变更请求中带有总的合格数和不合格数。
```

2019-1-10需求更新:
每天凌晨0点定时将当天的状态为已下发的计划发往监控app。
后续在计划监控模块中需要支持更新计划数据时同步到监控app。
监控app如果没有因为中途crash导致未接收到当天计划数据，可以从计划管理获取当天的计划。


